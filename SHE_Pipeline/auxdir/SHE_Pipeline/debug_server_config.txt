#########################################################################
# IAL CONFIGURATION ITEMS for PPO Processing
# 
# LODEEN SGS-SETTINGS
#
# GENERAL REMARKS
# - ALL properties that specify a time are given as double in units secs
# - This is a modified config file that will output everything to stdout
#
#########################################################################

#####################
# GENERAL Properties										
#####################
# Unique identifier for IAL instance
general.instancename=NOSDC
# Absolute path to base directory on IAL host
general.rootdirectory=/home/$USER/euclid-ial
pipelinerunner.concurrentruns=50
	
###########################
# WORKSPACE-Access, SHARED
###########################
# Protocol to access the workspace (FILE | SFTP)
workspace.protocol=FILE
workspace.rootpath=/home/$USER/euclid-ial/workspace

################################
# SUBMISSIONHOST Access, SHARED
################################
# Protocol to access the submission host (LOCAL | SSH)
submissionhost.protocol=LOCAL

###########################
# PIPELINE RUNNER Internal
###########################
# Logging settings
pipelinerunner.logging.module_port=logging.sock                     # TCP Port used logging service
pipelinerunner.logging.directory=logs                               # Logging directory
pipelinerunner.logging.filename=None                                # Name of log file
pipelinerunner.logging.useStdOut=1
pipelinerunner.logging.level=INFO                                   # Logging level
pipelinerunner.logging.numberRotatingFiles=10                       # Number of stored log files
pipelinerunner.logging.debugSQL=0                                   # Log SQL statements
pipelinerunner.logging.redirectStdErr=1                             # Redirect stdErr and stdOut to files

pipelinerunner.socket_dir=/tmp

# pipelinerunner.engine settings
pipelinerunner.engine.module_port=engine.sock                       # TCP Port used for engine service
pipelinerunner.engine.intervalInSec=5                               # Time interval between subsequent run submissions

# pipelinerunner.traverser settings
pipelinerunner.traverser.intervalInSec=5                            # Time interval between subsequent job status updates

# pipelinerunner.payload_job settings
pipelinerunner.payload_job.retries=1                                # Retries of the actual payload job execution
pipelinerunner.payload_job.tarLogFiles=0                            # Compress and store the logs of the payload jobs
pipelinerunner.payload_job.updateIntervalInSec=5                    # Interval for checking if new jobs are available
#pipelinerunner.payload_job.expandCPUCoresEnvVar=                   # Propagate the CPUcores number from PackageDef to the following, comma separated, environment values.
pipelinerunner.payload_job.expandCPUCoresEnvVar=MKL_NUM_THREADS,NUMEXPR_NUM_THREADS,OMP_NUM_THREADS,OPENBLAS_NUM_THREADS,VECLIB_MAXIMUM_THREADS,NTHREADS

# pipelinerunner.webserver settings
pipelinerunner.webserver.web_port=50000                             # TCP Port used to access the webinterface
pipelinerunner.webserver.bindIP=0.0.0.0                             # IP address to bind the webinterface on (0.0.0.0 = all interfaces)
pipelinerunner.webserver.plotDataflowGraph=1                        # Set to 0 to disable plotting of the Dataflow graph (save resources)

# pipelinerunner.drm_access settingss
pipelinerunner.drm_access.DRMCallsTimeoutInSec=60                   # Timeout in seconds of a DRM call
pipelinerunner.drm_access.submitUpdateIntervalInSec=2               # Time interval between subsequent pilot job submits 
pipelinerunner.drm_access.checkUpdateIntervalInSec=40               # Time interval between subsequent pilot job checks
#pipelinerunner.drm_access.drmSourcingScript=                                        # source command before any ialdrm call, e.g. "source xxx && ialdrm_yyy"
pipelinerunner.drm_access.drmPythonInterpreter=/usr/bin/python2.7                    # Python 2.7 interpreter used to launch ialdrm and where it is installed
pipelinerunner.drm_access.drmBinaryPath=$(dirname $(which ialdrm_submit_job))        # Path to bin folder containing the ialdrm executables


# Only needed if SSH is used to access the submission host
pipelinerunner.sshpool.maxconnections=10                            # Max session per endpoint
pipelinerunner.sshpool.maxidle=5                                    # Max number of idle connections
pipelinerunner.sshpool.retries=3                                    # Max number of retries to create a connection
pipelinerunner.sshpool.retrydelay=60                                # Delay between subsequent attempts to create a connection
pipelinerunner.sshpool.connecttimeout=60                            # Timeout for establishing a connection
pipelinerunner.sshpool.connectionrequesttimeout=60                  # Timeout for getting connection from pool, value of <=0 means unlimited

# Environment settings
environmentSourcingScripts.Eden-2.1-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environmentSourcingScripts.EDEN-2.1-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environmentSourcingScripts.2.1-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environmentSourcingScripts.Eden-2.1=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environmentSourcingScripts.EDEN-2.1=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environmentSourcingScripts.2.1=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environmentSourcingScripts.Eden-2.0=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environmentSourcingScripts.EDEN-2.0=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environmentSourcingScripts.2.0=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environmentSourcingScripts.Eden-2.0-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environmentSourcingScripts.EDEN-2.0-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environmentSourcingScripts.2.0-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
#The default script will be used if no "edenVersion" is defined in the pipeline submission data.
environmentSourcingScriptsDefault=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate

#pipelinerunner.pilotManager settings
pipelinerunner.pilotManager.module_port=pilot.sock                  # TCP Port used to access the pilotManager
pipelinerunner.pilotManager.updateIntervalInSec=5                   # Time interval between subsequent pilotManager tasks
pipelinerunner.pilotManager.httpTimeoutInSec=5                      # Timeout TCP requests

# pipelinerunner.pilots general pilot settings
pipelinerunner.pilots.url_to_pilot_manager=pilot.sock               # Pilot nodes use this URL to contact the PilotManager (FW Rules!)
                                                                    # --> Pilot Node sends http requests to pipelinerunner.pilotManager.module_port (default 50003)

pipelinerunner.pilots.url_to_logger=logging.sock                    # host:port of logging service which pilots call (FW Rules!)
                                                                    # --> Pilot Node sends logs via TCP Socket to pipelinerunner.logging.module_port

pipelinerunner.pilots.updateIntervalInSec=5                         # Time interval between subsequent job status updates
pipelinerunner.pilots.httpTimeoutInSec=5                            # HTTP call timeout, keep in snyc with IntervalInSec
pipelinerunner.pilots.connectionRetries=5                           # Make this graceful in order to survive a server restart/update
pipelinerunner.pilots.maxIdleTimeInSec=120                          # Time in Sec which a pilot stays idle before shutting down
pipelinerunner.pilots.taskcmd=E-Run IAL_WFM_Pilot 0.5.1 pilot_job   # Command used to start a Pilot on HPC Node
#pipelinerunner.pilots.sourcingScript=                              # Extends the pipelinerunner.pilots.taskcmd wit "source xxx && taskcmd"
pipelinerunner.pilots.sourcingScript=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.1.5/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate

# Profiling settings
pipelinerunner.profiling.pilots=0
pipelinerunner.profiling.payload_jobs=0
#pipelinerunner.profiling.additional_cmd=

pipelinerunner.messaging.socketType=ipc
pipelinerunner.messaging.subSocketBindAddress=${PIPELINERUNNER_RUNID}_sub.sock
pipelinerunner.messaging.pubSocketBindAddress=${PIPELINERUNNER_RUNID}_pub.sock

pipelinerunner.pilot.genericLight.cores=4
pipelinerunner.pilot.genericLight.ramInMB=18000
pipelinerunner.pilot.genericLight.walltimeInMin=4320
pipelinerunner.pilot.genericLight.maxInstances=1

environment.sourcingScripts.empty=; echo
environment.sourcingScripts.ialtest=$PIPELINERUNNER_PACKAGE/test_pipelines/executables/ialtest_env.sh
environment.sourcingScripts.eden-2.0=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environment.sourcingScripts.eden-2.0-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environment.sourcingScripts.2.0=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environment.sourcingScripts.2.0-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.0/etc/profile.d/euclid.sh
environment.sourcingScripts.eden-2.1=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environment.sourcingScripts.eden-2.1-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environment.sourcingScripts.2.1=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
environment.sourcingScripts.2.1-dev=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid-dev.in2p3.fr/CentOS7/EDEN-2.1/bin/activate

environment.sourcingScriptsDefault=/cvmfs/euclid-dev.in2p3.fr/CentOS7/INFRA/CONFIG/GENERIC/2.2/ppo/clean_cvmfs_environment.sh && source /cvmfs/euclid.in2p3.fr/CentOS7/EDEN-2.1/bin/activate
